name: LaTeX Compilation Test

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

jobs:
  compile-latex:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
    
    - name: Install LaTeX and ImageMagick
      run: |
        sudo apt-get update
        sudo apt-get install -y texlive-latex-extra texlive-fonts-recommended texlive-fonts-extra
        sudo apt-get install -y texlive-latex-recommended imagemagick
    
    - name: Create demo assets
      run: |
        mkdir -p assets
        # Create a demo profile photo (blue rectangle with "PHOTO" text)
        convert -size 300x400 xc:"#e8f4f8" -gravity center -pointsize 24 -fill "#0056a0" -annotate +0+0 "DEMO\nPHOTO" assets/profile_photo.jpg
        # Create a demo university logo (rectangle with "UNIVERSITY" text)
        convert -size 200x80 xc:"#f0f8ff" -gravity center -pointsize 14 -fill "#003366" -annotate +0+0 "UNIVERSITY\nLOGO" assets/university_logo.png
    
    - name: Create test config file
      run: |
        cp examples/config_example.tex config.tex
    
    - name: Compile LaTeX document
      run: |
        pdflatex -interaction=nonstopmode academic_cv_template.tex
        pdflatex -interaction=nonstopmode academic_cv_template.tex
    
    - name: Check if PDF was created
      run: |
        if [ -f academic_cv_template.pdf ]; then
          echo "✅ PDF compilation successful"
          ls -la academic_cv_template.pdf
        else
          echo "❌ PDF compilation failed"
          exit 1
        fi
    
    - name: Upload PDF artifact
      uses: actions/upload-artifact@v4
      if: success()
      with:
        name: compiled-cv
        path: academic_cv_template.pdf
        retention-days: 30
    
    - name: Upload logs on failure
      uses: actions/upload-artifact@v4
      if: failure()
      with:
        name: latex-logs
        path: |
          *.log
          *.aux
        retention-days: 7
